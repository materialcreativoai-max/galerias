<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Aqu√≠ Nom√°s ‚Äî DEMO inteligente (sin√≥nimos + fallback CSV + im√°genes)</title>
<!--ID_SYS:AQNM_20251110_V5-->
<style>
:root {
  --pri:#0b5cff;
  --bg:#f2f4f8;
}
body {
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  margin:0;
  background:var(--bg);
  color:#0b1220;
}
.wrap {
  max-width:900px;
  margin:0 auto;
  padding:16px;
}
h1 {
  font-size:22px;
  margin:0 0 12px;
}
.box {
  background:#fff;
  border:1px solid #e2e8f0;
  border-radius:14px;
  padding:12px 14px;
  margin-bottom:14px;
  box-shadow:0 2px 8px rgba(0,0,0,0.06);
  display:flex;
  align-items:center;
  gap:12px;
  transition:transform .15s ease,box-shadow .15s ease;
}
.box:hover {
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.logo {
  width:60px;
  height:60px;
  border-radius:50%;
  object-fit:cover;
  flex-shrink:0;
  border:1px solid #d0d7de;
  background:#fafafa;
}
.info {
  flex:1;
}
.name {
  font-weight:600;
  color:#0b1220;
}
.rubro {
  font-size:14px;
  color:#555;
}
.dir {
  font-size:13px;
  color:#777;
}
.row {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
  margin-bottom:10px;
}
.input {
  flex:1 1 200px;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid #cbd5e1;
  font-size:15px;
}
button {
  background:var(--pri);
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 14px;
  font-size:15px;
  cursor:pointer;
}
button:hover {opacity:.9;}
small {display:block;color:#666;margin-top:8px;font-size:13px;}
</style>
</head>
<body>
<div class="wrap">
  <h1>üîé Aqu√≠ Nom√°s ‚Äî versi√≥n inteligente</h1>
  <div class="row">
    <input id="busqueda" class="input" placeholder="¬øQu√© busc√°s? (Ej: almorzar en el centro)"/>
    <button id="buscarBtn">Buscar</button>
    <button id="vozBtn">üé§</button>
    <button id="cercaBtn">Cerca</button>
    <button id="limpiarBtn">Limpiar</button>
  </div>
  <small>La b√∫squeda entiende sin√≥nimos y funciona por voz o texto.</small>
  <div id="resultados"></div>
</div>

<script>
let locales = [];
let sinonimos = {"almorzar":["comer","almuerzo","restaurante","plato del d√≠a"],
                 "caf√©":["cafeter√≠a","bar","espresso"],
                 "helado":["postre","helader√≠a"]};

function normalizar(txt){
  return txt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}

async function cargarCSV(){
  try{
    console.log("Cargando CSV‚Ä¶");
    const resp = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vSg0UeYMVZj0b9H2V63XS37oXlIwJ6SL4n-m6WJEbspzM5OP9QA3QF6qSw4fr81dw/pub?gid=1861393565&single=true&output=csv");
    const texto = await resp.text();
    const filas = texto.trim().split("\n").map(f=>f.split(","));
    const cab = filas.shift().map(c=>c.trim());
    locales = filas.map(f=>{
      let obj={};
      cab.forEach((c,i)=>obj[c]=f[i]);
      return obj;
    });
    console.log("CSV cargado:",locales.length,"filas");
  }catch(e){
    console.error("Error al cargar CSV",e);
  }
}

function mostrarLocales(lista){
  const cont=document.getElementById("resultados");
  cont.innerHTML="";
  if(!lista.length){cont.innerHTML="<p>No se encontraron locales.</p>";return;}
  lista.forEach(l=>{
    const box=document.createElement("div");
    box.className="box";
    if(l.imagen_url){
      const img=document.createElement("img");
      img.src=l.imagen_url.trim();
      img.alt=l.nombre_local;
      img.className="logo";
      box.appendChild(img);
    }
    const info=document.createElement("div");
    info.className="info";
    info.innerHTML=`<div class="name">${l.nombre_local}</div>
                    <div class="rubro">${l.rubro||""}</div>
                    <div class="dir">${l.direccion||""}</div>`;
    box.appendChild(info);
    cont.appendChild(box);
  });
}

function buscar(){
  const q=document.getElementById("busqueda").value.trim();
  if(!q){return;}
  const query=normalizar(q);
  const palabras=query.split(/\s+/);
  const lista=locales.filter(l=>{
    const texto=normalizar(`${l.nombre_local} ${l.rubro} ${l.keywords} ${l.barrio} ${l.promo_texto}`);
    return palabras.some(p=>{
      if(texto.includes(p)) return true;
      const alt=sinonimos[p];
      return alt && alt.some(s=>texto.includes(s));
    });
  });
  mostrarLocales(lista);
}

function limpiar(){
  document.getElementById("busqueda").value="";
  document.getElementById("resultados").innerHTML="";
}

function usarVoz(){
  const recog=new(window.SpeechRecognition||window.webkitSpeechRecognition)();
  recog.lang="es-AR";
  recog.start();
  recog.onresult=e=>{
    const txt=e.results[0][0].transcript;
    document.getElementById("busqueda").value=txt;
    buscar();
  };
}

function cerca(){
  if(!navigator.geolocation){alert("Geolocalizaci√≥n no disponible.");return;}
  navigator.geolocation.getCurrentPosition(pos=>{
    const {latitude,longitude}=pos.coords;
    const lista=locales.filter(l=>{
      const lat=parseFloat(l.lat),lng=parseFloat(l.lng);
      if(!lat||!lng) return false;
      const d=Math.sqrt((lat-latitude)**2+(lng-longitude)**2);
      return d<0.03;
    });
    mostrarLocales(lista);
  },()=>alert("No se pudo obtener ubicaci√≥n."));
}

document.getElementById("buscarBtn").onclick=buscar;
document.getElementById("vozBtn").onclick=usarVoz;
document.getElementById("cercaBtn").onclick=cerca;
document.getElementById("limpiarBtn").onclick=limpiar;

cargarCSV();
</script>
</body>
</html>
